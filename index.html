<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Checklist RI - FIIs (mensal)</title>
<style>
:root{
  --bg:#0f1724; --card:#0b1220; --muted:#9aa7b2; --accent:#60a5fa; --glass: rgba(255,255,255,0.03);
  --success:#10b981; --danger:#ef4444; --card-border: rgba(255,255,255,0.04);
  font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
}
*{box-sizing:border-box}
body{margin:0;background:linear-gradient(180deg,#071027 0%, #071a2a 100%); color:#e6eef3; font-smoothing:antialiased;}
.wrap{max-width:1100px;margin:28px auto;padding:20px;}
header{display:flex;gap:12px;align-items:center;margin-bottom:18px}
h1{font-size:20px;margin:0}
.sub{color:var(--muted);font-size:13px}
.topbar{display:flex;gap:8px;margin-left:auto;align-items:center}
select,input[type="text"],button{background:var(--glass);border:1px solid var(--card-border);color:inherit;padding:8px 10px;border-radius:8px;font-size:14px;}
button{cursor:pointer}
.layout{display:grid;grid-template-columns:260px 1fr;gap:16px}
.panel{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); border:1px solid var(--card-border); padding:12px;border-radius:12px}
.months{display:flex;flex-direction:column;gap:8px}
.month-btn{display:flex;justify-content:space-between;align-items:center;padding:8px;border-radius:8px;background:transparent;border:1px dashed var(--card-border);font-size:14px}
.month-btn.active{background:linear-gradient(90deg, rgba(96,165,250,0.12), rgba(96,165,250,0.04));border:1px solid rgba(96,165,250,0.18)}
.controls{display:flex;gap:8px;align-items:center}
.search{margin:8px 0}
.content{max-height:72vh;overflow:auto;padding:12px}
section{margin-bottom:18px}
section h2{margin:0 0 8px 0;font-size:15px}
.grid-2{display:grid;grid-template-columns:repeat(2,1fr);gap:12px}
.item{display:flex;gap:8px;align-items:flex-start;padding:8px;border-radius:8px;border:1px solid transparent; flex-wrap: wrap;}
label{display:flex;align-items:center;gap:8px}
input[type="checkbox"]{width:18px;height:18px}
.note{width:100%;min-height:36px;padding:8px;border-radius:8px;background:#071827;border:1px solid var(--card-border);color:var(--muted);resize:vertical}
.row{display:flex;gap:8px;align-items:center}
.muted{color:var(--muted);font-size:13px}
footer{display:flex;justify-content:space-between;align-items:center;margin-top:12px}
.small{font-size:13px;color:var(--muted)}
.btn-danger{background:transparent;border:1px solid var(--danger);color:var(--danger);padding:6px 8px;border-radius:8px}
.btn-primary{background:linear-gradient(90deg,var(--accent),#3b82f6);border:0;color:#021127;padding:8px 12px;border-radius:8px}
.controls .icon{opacity:0.9}
.tag{font-size:12px;padding:4px 8px;border-radius:999px;background:rgba(255,255,255,0.03);border:1px solid var(--card-border)}
@media(max-width:880px){.layout{grid-template-columns:1fr;}.months{flex-direction:row;overflow:auto}.months .month-btn{min-width:200px}}
</style>
</head>
<body>
<div class="wrap">
  <header>
    <div>
      <h1>üìã Checklist RI ‚Äî Fundos Imobili√°rios</h1>
      <div class="sub">Mantenha um hist√≥rico mensal ‚Äî salva localmente no navegador</div>
    </div>

    <div class="topbar">
      <div class="controls">
        <select id="monthSelect" title="Escolha m√™s/ano"></select>
        <input id="newMonthName" type="text" placeholder="MM/YYYY (Ex: 09/2025)" style="width:120px">
        <input id="fiiTicker" type="text" placeholder="Ativo (Ex: XPLG11)" style="width:100px" title="Insira o ticker do fundo" />
        <button id="addMonthBtn" title="Adicionar m√™s">‚ûï</button>
        <button id="saveBtn" class="btn-primary" title="Salvar agora">Salvar</button>
      </div>
      <div style="width:10px"></div>
      <button id="exportBtn">Exportar JSON</button>
      <button id="importBtn">Importar JSON</button>
      <input id="importFile" type="file" accept=".json" style="display:none">
      <button id="printBtn">Imprimir</button>
    </div>
  </header>

  <div class="layout">
    <aside class="panel">
      <div style="display:flex;align-items:center;gap:8px;margin-bottom:8px">
        <strong>Meses salvos</strong>
        <span class="tag" id="countTag">0</span>
      </div>
      <div class="months" id="monthsList" aria-live="polite"></div>
      <div style="margin-top:12px">
        <div class="small">Busca no checklist:</div>
        <input id="searchInput" type="text" placeholder="Pesquisar termo..." style="width:100%;margin-top:6px">
      </div>
      <hr style="margin:12px 0;border-color:var(--card-border)">
      <div class="small">Exportar / Importar salva todo o banco local (√∫til para backup).</div>
      <div style="margin-top:10px" class="small muted">OBS: dados ficam no navegador; limpar cache remove tudo.</div>
    </aside>

    <main class="panel">
      <div class="content" id="contentArea">

        <!-- Se√ß√£o: Estrutura do Fundo -->
        <section>
          <h2>üè¶ Estrutura do Fundo</h2>
          <div class="item">
            <label><input type="checkbox" data-key="estrutura.estrategia" /> Qual a estrat√©gia/objetivo do fundo?</label>
            <textarea class="note" data-key="estrutura.obs" placeholder="Observa√ß√µes"></textarea>
          </div>
        </section>

        <!-- Se√ß√£o: Segmento / Tipo -->
        <section>
          <h2>üìä Segmento e Tipo</h2>
          <div class="item">
            <label><input type="checkbox" data-key="segmento.segmento" /> Segmento do fundo</label>
            <textarea class="note" data-key="segmento.obs" placeholder="Observa√ß√µes"></textarea>
          </div>
          <div class="item">
            <label><input type="checkbox" data-key="tipo.tipo" /> Tipo do fundo</label>
            <textarea class="note" data-key="tipo.obs" placeholder="Observa√ß√µes"></textarea>
          </div>
        </section>

        <!-- Se√ß√£o: Dividendos / Rendimento -->
        <section>
          <h2>üíµ Dividendos / Rendimento</h2>
          <div class="item">
            <label><input type="checkbox" data-key="dividendos.regularidade" /> Regularidade de pagamento</label>
            <textarea class="note" data-key="dividendos.obs" placeholder="Observa√ß√µes"></textarea>
          </div>
          <div class="item">
            <label><input type="checkbox" data-key="dividendos.historico" /> Hist√≥rico de rendimento</label>
            <textarea class="note" data-key="dividendos.historico_obs" placeholder="Observa√ß√µes"></textarea>
          </div>
        </section>

        <!-- Se√ß√£o: Ativos / Portf√≥lio -->
        <section>
          <h2>üè¢ Ativos / Portf√≥lio</h2>
          <div class="item">
            <label><input type="checkbox" data-key="ativos.quantidade" /> Quantidade de ativos</label>
            <textarea class="note" data-key="ativos.obs" placeholder="Observa√ß√µes"></textarea>
          </div>
          <div class="item">
            <label><input type="checkbox" data-key="ativos.localizacao" /> Localiza√ß√£o dos im√≥veis</label>
            <textarea class="note" data-key="ativos.localizacao_obs" placeholder="Observa√ß√µes"></textarea>
          </div>
        </section>

        <!-- Se√ß√£o: Gest√£o -->
        <section>
          <h2>üë®‚Äçüíº Gest√£o</h2>
          <div class="item">
            <label><input type="checkbox" data-key="gestao.administrador" /> Administrador do fundo</label>
            <textarea class="note" data-key="gestao.obs" placeholder="Observa√ß√µes"></textarea>
          </div>
          <div class="item">
            <label><input type="checkbox" data-key="gestao.gestor" /> Gestor do fundo</label>
            <textarea class="note" data-key="gestao.gestor_obs" placeholder="Observa√ß√µes"></textarea>
          </div>
        </section>

        <!-- Se√ß√£o: Documentos / RI -->
        <section>
          <h2>üìÑ Documentos / RI</h2>
          <div class="item">
            <label><input type="checkbox" data-key="ri.demonstrativos" /> Demonstrativos publicados</label>
            <textarea class="note" data-key="ri.obs" placeholder="Observa√ß√µes"></textarea>
          </div>
          <div class="item">
            <label><input type="checkbox" data-key="ri.assembleias" /> Convoca√ß√µes e atas</label>
            <textarea class="note" data-key="ri.assembleias_obs" placeholder="Observa√ß√µes"></textarea>
          </div>
        </section>

      </div>

      <footer>
        <div class="small">√öltima edi√ß√£o: <span id="lastSaved">‚Äî</span></div>
        <div><button id="clearBtn" class="btn-danger">Limpar m√™s</button></div>
      </footer>
    </main>
  </div>
</div>

<script>
const STORAGE_KEY = 'fii_checklist_v1';

function defaultStructure(){
  const nodes = document.querySelectorAll('[data-key]');
  const obj = {};
  nodes.forEach(n=>{
    const k = n.getAttribute('data-key');
    if(!k) return;
    if(n.type==='checkbox') obj[k] = false;
    else obj[k] = '';
  });
  obj['meta.ativo']='';
  return obj;
}

function loadDB(){ try{ const raw=localStorage.getItem(STORAGE_KEY); return raw?JSON.parse(raw):{months:{},order:[]};}catch(e){return{months:{},order:[]}}}
function saveDB(db){ localStorage.setItem(STORAGE_KEY, JSON.stringify(db)); }

function populateMonthSelect(){
  const sel=document.getElementById('monthSelect'); sel.innerHTML='';
  const db=loadDB();
  db.order.forEach(m=>{ const opt=document.createElement('option'); opt.value=m; opt.textContent=m; sel.appendChild(opt); });
  if(sel.options.length) sel.value=sel.options[sel.options.length-1].value;
}

function renderMonthsList(){
  const list=document.getElementById('monthsList'); list.innerHTML='';
  const db=loadDB();
  db.order.forEach(m=>{
    const div=document.createElement('div'); div.className='month-btn'+(m===getCurrentMonthKey()?' active':''); div.textContent=m;
    div.onclick=()=>{setCurrentMonth(m)};
    const del=document.createElement('button'); del.textContent='üóëÔ∏è'; del.style.marginLeft='8px'; del.title='Remover m√™s';
    del.onclick=(ev)=>{ev.stopPropagation(); if(confirm('Remover m√™s "'+m+'"?')) deleteMonth(m);};
    div.appendChild(del); list.appendChild(div);
  });
  document.getElementById('countTag').textContent=db.order.length;
}

function getCurrentMonthKey(){ return document.getElementById('monthSelect').value || null; }

function setCurrentMonth(m){
  document.getElementById('monthSelect').value=m;
  renderMonthsList();
  loadMonthToUI(m);
}

function addMonth(m){
  if(!m){ alert('Informe M√äS/ANO no formato MM/YYYY'); return; }
  const db=loadDB();
  if(db.order.includes(m)){ alert('M√™s j√° existe'); return; }
  db.order.push(m);
  db.months[m]=defaultStructure();
  saveDB(db);
  populateMonthSelect(); renderMonthsList(); setCurrentMonth(m);
}

function deleteMonth(m){
  const db=loadDB();
  if(!db.order.includes(m)) return;
  delete db.months[m];
  db.order=db.order.filter(x=>x!==m);
  saveDB(db);
  populateMonthSelect(); renderMonthsList();
  const sel=document.getElementById('monthSelect');
  if(sel.options.length) setCurrentMonth(sel.options[sel.options.length-1].value);
  else clearUI();
}

function clearUI(){ 
  document.querySelectorAll('[data-key]').forEach(n=>{ if(n.type==='checkbox') n.checked=false; else n.value=''; }); 
  document.getElementById('fiiTicker').value=''; 
}

function loadMonthToUI(m){
  clearUI();
  const db=loadDB();
  const data=db.months[m]; if(!data) return;
  document.getElementById('fiiTicker').value = data['meta.ativo']||'';
  document.querySelectorAll('[data-key]').forEach(n=>{
    const k=n.getAttribute('data-key');
    if(n.type==='checkbox') n.checked = !!data[k];
    else n.value = data[k]||'';
  });
  document.getElementById('lastSaved').textContent = new Date().toLocaleString();
}

function saveCurrentMonth(){
  const m=getCurrentMonthKey(); if(!m) return alert('Selecione m√™s');
  const db=loadDB(); if(!db.months[m]) db.months[m]=defaultStructure();
  const data=db.months[m];
  document.querySelectorAll('[data-key]').forEach(n=>{
    const k=n.getAttribute('data-key'); if(!k) return;
    if(n.type==='checkbox') data[k]=n.checked;
    else data[k]=n.value;
  });
  data['meta.ativo'] = document.getElementById('fiiTicker').value;
  saveDB(db);
  document.getElementById('lastSaved').textContent = new Date().toLocaleString();
  renderMonthsList();
}

document.getElementById('addMonthBtn').onclick=()=>addMonth(document.getElementById('newMonthName').value.trim());
document.getElementById('monthSelect').onchange=()=>setCurrentMonth(getCurrentMonthKey());
document.getElementById('saveBtn').onclick=saveCurrentMonth;
document.getElementById('clearBtn').onclick=()=>{ if(confirm('Limpar os campos do m√™s atual?')) clearUI(); };
document.getElementById('exportBtn').onclick=()=>{
  const blob=new Blob([JSON.stringify(loadDB(),null,2)],{type:'application/json'});
  const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download='checklist_fii.json'; a.click();
};
document.getElementById('importBtn').onclick=()=>document.getElementById('importFile').click();
document.getElementById('importFile').onchange=(ev)=>{
  const file=ev.target.files[0]; if(!file) return;
  const reader=new FileReader();
  reader.onload=e=>{
    try{
      const data=JSON.parse(e.target.result);
      localStorage.setItem(STORAGE_KEY,JSON.stringify(data));
      populateMonthSelect(); renderMonthsList(); alert('Importa√ß√£o conclu√≠da!');
    }catch(err){ alert('Erro ao importar JSON'); }
  };
  reader.readAsText(file);
};
document.getElementById('printBtn').onclick=()=>window.print();

// inicializa√ß√£o
populateMonthSelect();
renderMonthsList();
if(document.getElementById('monthSelect').options.length) setCurrentMonth(document.getElementById('monthSelect').options[0].value);
</script>
</body>
</html>
