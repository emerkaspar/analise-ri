<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>FII Analyzer Pro</title>

    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>

    <!-- Importação da fonte Inter do Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />

    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <style>
      :root {
        --bg: #0f1724;
        --card: #0b1220;
        --muted: #9aa7b2;
        --accent: #60a5fa;
        --glass: rgba(255, 255, 255, 0.03);
        --success: #10b981;
        --danger: #ef4444;
        --warning: #f59e0b;
        --card-border: rgba(255, 255, 255, 0.04);
        font-family: "Inter", ui-sans-serif, system-ui, -apple-system,
          "Segoe UI", Roboto, "Helvetica Neue", Arial;
      }

      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }

      body {
        background-color: var(--bg);
        color: white;
        line-height: 1.6;
        padding: 20px;
        min-height: 100vh;
        font-family: "Inter", ui-sans-serif, system-ui, -apple-system,
          "Segoe UI", Roboto, "Helvetica Neue", Arial;
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
        background: var(--card);
        padding: 30px;
        border-radius: 16px;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
        border: 1px solid var(--card-border);
      }

      /* HEADER EM LINHA ÚNICA */
      header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 30px;
        padding-bottom: 20px;
        border-bottom: 1px solid var(--glass);
        flex-wrap: wrap;
        gap: 20px;
      }

      .logo-section {
        display: flex;
        align-items: center;
        gap: 15px;
        flex-shrink: 0;
      }

      .logo {
        max-width: 120px;
        height: auto;
      }

      .logo img {
        width: 100%;
        height: auto;
        border-radius: 8px;
      }

      .titles {
        display: flex;
        flex-direction: column;
        justify-content: center;
      }

      h1 {
        color: var(--accent);
        font-size: 1.8rem;
        font-weight: 700;
        line-height: 1.2;
        margin: 0;
      }

      .app-description {
        color: var(--muted);
        font-size: 0.95rem;
        font-weight: 400;
        margin-top: 4px;
      }

      .auth-section {
        margin: 0;
        padding: 12px 16px;
        background-color: var(--glass);
        border-radius: 12px;
        border: 1px solid var(--card-border);
        text-align: center;
        flex-shrink: 0;
        min-width: 200px;
      }

      .auth-section h3 {
        font-size: 1rem;
        margin-bottom: 8px;
      }

      .auth-section p {
        font-size: 0.8rem;
        margin-bottom: 10px;
      }

      .user-info {
        margin-top: 8px;
        padding: 8px;
        background: rgba(96, 165, 250, 0.1);
        border-radius: 6px;
        font-size: 0.8rem;
      }

      .auth-buttons {
        display: flex;
        flex-direction: column;
        gap: 8px;
        margin-top: 10px;
      }

      .auth-buttons button {
        padding: 8px 12px;
        font-size: 0.85rem;
      }

      .firebase-status {
        margin-top: 8px;
        padding: 6px;
        border-radius: 6px;
        font-size: 0.8rem;
      }

      /* Resto do CSS permanece igual */
      .tabs {
        display: flex;
        margin-bottom: 20px;
        border-bottom: 1px solid var(--glass);
        flex-wrap: wrap;
      }

      .tab {
        padding: 12px 20px;
        cursor: pointer;
        background: var(--glass);
        border-radius: 8px 8px 0 0;
        margin-right: 5px;
        border: 1px solid var(--card-border);
        border-bottom: none;
        color: var(--muted);
        transition: all 0.3s ease;
      }

      .tab.active {
        background: var(--card);
        font-weight: bold;
        color: var(--accent);
      }

      .tab:hover {
        background: rgba(96, 165, 250, 0.1);
      }

      .tab-content {
        display: none;
      }

      .tab-content.active {
        display: block;
      }

      .fund-info {
        display: flex;
        flex-wrap: wrap;
        gap: 20px;
        margin-bottom: 30px;
        padding: 20px;
        background-color: var(--glass);
        border-radius: 12px;
        border: 1px solid var(--card-border);
      }

      .fund-info input,
      .fund-info select {
        padding: 12px;
        border: 1px solid var(--card-border);
        border-radius: 8px;
        flex: 1;
        min-width: 200px;
        background: rgba(0, 0, 0, 0.2);
        color: white;
      }

      .fund-info input::placeholder {
        color: var(--muted);
      }

      .section {
        margin-bottom: 30px;
        padding: 20px;
        border-radius: 12px;
        background-color: var(--glass);
        border: 1px solid var(--card-border);
      }

      .section-title {
        display: flex;
        align-items: center;
        margin-bottom: 20px;
        color: var(--accent);
      }

      .section-title h2 {
        margin-left: 10px;
        font-size: 1.5rem;
      }

      .checklist-item {
        margin-bottom: 15px;
        padding: 15px;
        background-color: rgba(0, 0, 0, 0.2);
        border-radius: 8px;
        border-left: 3px solid var(--accent);
      }

      .checklist-item label {
        display: block;
        margin-bottom: 8px;
        font-weight: 600;
        color: white;
      }

      .checkbox-group {
        display: flex;
        flex-wrap: wrap;
        gap: 15px;
        margin-top: 8px;
        margin-bottom: 15px;
      }

      .checkbox-item {
        display: flex;
        align-items: center;
        background: rgba(0, 0, 0, 0.2);
        padding: 8px 12px;
        border-radius: 6px;
        border: 1px solid var(--card-border);
      }

      .checkbox-item input[type="checkbox"],
      .checkbox-item input[type="radio"] {
        margin-right: 8px;
      }

      textarea,
      input[type="text"],
      input[type="number"] {
        width: 100%;
        padding: 12px;
        border: 1px solid var(--card-border);
        border-radius: 8px;
        margin-top: 5px;
        background: rgba(0, 0, 0, 0.2);
        color: white;
        resize: vertical;
      }

      textarea {
        min-height: 80px;
      }

      textarea::placeholder {
        color: var(--muted);
      }

      .btn-group {
        display: flex;
        justify-content: center;
        gap: 15px;
        margin-top: 30px;
      }

      button {
        padding: 12px 25px;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-weight: 600;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .btn-save {
        background-color: var(--success);
        color: white;
      }

      .btn-save:hover {
        background-color: #0da271;
      }

      .btn-reset {
        background-color: var(--danger);
        color: white;
      }

      .btn-reset:hover {
        background-color: #dc2626;
      }

      .btn-print {
        background-color: var(--accent);
        color: white;
      }

      .btn-print:hover {
        background-color: #3b82f6;
      }

      .btn-warning {
        background-color: var(--warning);
        color: white;
      }

      .btn-warning:hover {
        background-color: #d97706;
      }

      .search-box {
        display: flex;
        margin-bottom: 20px;
        gap: 10px;
      }

      .search-box input {
        flex: 1;
        padding: 12px;
        border: 1px solid var(--card-border);
        border-radius: 8px;
        background: rgba(0, 0, 0, 0.2);
        color: white;
      }

      .search-box input::placeholder {
        color: var(--muted);
      }

      .search-box button {
        padding: 12px 20px;
      }

      .reports-list {
        margin-top: 20px;
      }

      .report-item {
        padding: 15px;
        border: 1px solid var(--card-border);
        border-radius: 8px;
        margin-bottom: 10px;
        background: var(--glass);
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .report-info {
        flex: 1;
      }

      .report-info h3 {
        color: var(--accent);
        margin-bottom: 5px;
      }

      .report-info p {
        color: var(--muted);
        font-size: 0.9rem;
      }

      .report-actions {
        display: flex;
        gap: 10px;
      }

      .report-btn {
        padding: 8px 12px;
        font-size: 14px;
      }

      .storage-info {
        margin-top: 20px;
        padding: 15px;
        background: rgba(96, 165, 250, 0.1);
        border-radius: 8px;
        text-align: center;
        border: 1px solid var(--card-border);
      }

      .storage-info p {
        color: var(--muted);
        margin-bottom: 10px;
      }

      .status-connected {
        background: rgba(16, 185, 129, 0.1);
        color: var(--success);
        border: 1px solid var(--success);
      }

      .status-disconnected {
        background: rgba(239, 68, 68, 0.1);
        color: var(--danger);
        border: 1px solid var(--danger);
      }

      .setup-guide {
        margin-top: 20px;
        padding: 20px;
        background: rgba(96, 165, 250, 0.1);
        border-radius: 12px;
        border: 1px solid var(--card-border);
      }

      .setup-guide h3 {
        color: var(--accent);
        margin-bottom: 15px;
      }

      .setup-steps {
        margin-left: 20px;
        margin-bottom: 15px;
      }

      .setup-steps li {
        margin-bottom: 10px;
        line-height: 1.6;
      }

      @media print {
        button,
        .tabs,
        .search-box {
          display: none;
        }

        .container {
          box-shadow: none;
          border: none;
          background: white;
          color: black;
        }

        .tab-content {
          display: block !important;
        }

        .section {
          background: white;
          border: 1px solid #ddd;
        }

        .checklist-item {
          background: #f9f9f9;
          border-left: 3px solid #333;
        }
      }

      @media (max-width: 992px) {
        header {
          flex-direction: column;
          align-items: flex-start;
        }

        .logo-section {
          width: 100%;
          justify-content: center;
          margin-bottom: 15px;
        }

        .titles {
          text-align: center;
          width: 100%;
        }

        .auth-section {
          width: 100%;
        }
      }

      @media (max-width: 768px) {
        .logo {
          max-width: 100px;
        }

        h1 {
          font-size: 1.5rem;
        }

        .fund-info {
          flex-direction: column;
        }

        .fund-info input,
        .fund-info select {
          width: 100%;
        }

        .btn-group {
          flex-direction: column;
        }

        .report-item {
          flex-direction: column;
          gap: 10px;
        }

        .report-actions {
          width: 100%;
          justify-content: center;
        }

        .tabs {
          flex-direction: column;
        }

        .tab {
          margin-bottom: 5px;
          border-radius: 8px;
          border: 1px solid var(--card-border);
        }

        .auth-buttons {
          flex-direction: column;
        }
      }

      @media (max-width: 480px) {
        .logo {
          max-width: 80px;
        }

        h1 {
          font-size: 1.3rem;
        }

        .app-description {
          font-size: 0.85rem;
        }

        .container {
          padding: 20px;
        }
      }

      .observations {
        margin-top: 15px;
      }

      .observations textarea {
        background: rgba(0, 0, 0, 0.3);
        border: 1px solid var(--card-border);
      }

      .checkbox-item {
        transition: all 0.2s ease;
      }

      .checkbox-item:hover {
        background: rgba(96, 165, 250, 0.1);
      }

      .checkbox-item input[type="checkbox"]:checked,
      .checkbox-item input[type="radio"]:checked {
        accent-color: var(--accent);
      }

      .loading {
        display: inline-block;
        width: 20px;
        height: 20px;
        border: 3px solid rgba(255, 255, 255, 0.3);
        border-radius: 50%;
        border-top-color: var(--accent);
        animation: spin 1s ease-in-out infinite;
      }

      @keyframes spin {
        to {
          transform: rotate(360deg);
        }
      }

      .error-message {
        background-color: rgba(239, 68, 68, 0.2);
        color: var(--danger);
        padding: 10px;
        border-radius: 8px;
        margin: 10px 0;
        border: 1px solid var(--danger);
      }

      .success-message {
        background-color: rgba(16, 185, 129, 0.2);
        color: var(--success);
        padding: 10px;
        border-radius: 8px;
        margin: 10px 0;
        border: 1px solid var(--success);
      }
    </style>
  </head>
  <body>
    <div class="container">
      <!-- HEADER EM LINHA ÚNICA -->
      <header>
        <div class="logo-section">
          <div class="logo">
            <img
              src="https://i.ibb.co/9kpYwVdn/logomarca-com-fundo.png"
              alt="GD Checklist de Análise de FIIs"
            />
          </div>
          <div class="titles">
            <h1>Fundoscópio</h1>
            <p class="app-description">
              Ferramenta Completa de Análise de FII's para alunos da mentoria
              Geração Dividendos.
            </p>
          </div>
        </div>

        <div class="auth-section" id="auth-section">
          <h3><i class="fas fa-user"></i> Login</h3>
          <p>Faça login para salvar suas análises</p>
          <div class="firebase-status" id="firebase-status">
            Verificando conexão...
          </div>
          <div id="user-info" class="user-info" style="display: none">
            <p>Logado como: <span id="user-email"></span></p>
          </div>
          <div class="auth-buttons">
            <button id="login-btn" class="btn-save">
              <i class="fas fa-sign-in-alt"></i> Fazer Login
            </button>
            <button id="logout-btn" class="btn-reset" style="display: none">
              <i class="fas fa-sign-out-alt"></i> Sair
            </button>
          </div>
        </div>
      </header>

      <div class="tabs">
        <div class="tab active" data-tab="form">Nova Análise</div>
        <div class="tab" data-tab="reports">Relatórios Salvos</div>
        <div class="tab" data-tab="help">Ajuda</div>
      </div>

      <div class="tab-content active" id="form-tab">
        <div class="fund-info">
          <input type="text" id="fund-name" placeholder="Nome do Fundo" />
          <input
            type="text"
            id="analysis-date"
            placeholder="Mês/Ano de Referência (MM/AAAA)"
          />
          <input type="text" id="analyst-name" placeholder="Nome do Analista" />
        </div>

        <form id="checklist-form">
          <!-- ESTRUTURA DO FUNDO -->
          <div class="section">
            <div class="section-title">
              <span>🏦</span>
              <h2>Estrutura do Fundo</h2>
            </div>

            <div class="checklist-item">
              <label
                >Qual a estratégia/objetivo do fundo? (renda, ganho de capital,
                reciclagem de portfólio, etc.)</label
              >
              <textarea
                id="strategy"
                placeholder="Descreva a estratégia do fundo..."
              ></textarea>
            </div>

            <div class="checklist-item">
              <label
                >Segmento principal do fundo? – ⚠️ Híbrido não é segmento</label
              >
              <div class="checkbox-group">
                <div class="checkbox-item">
                  <input type="checkbox" id="logistics" name="segment" />
                  <label for="logistics">📦 Logística</label>
                </div>
                <div class="checkbox-item">
                  <input type="checkbox" id="offices" name="segment" />
                  <label for="offices">🏢 Lajes</label>
                </div>
                <div class="checkbox-item">
                  <input type="checkbox" id="shoppings" name="segment" />
                  <label for="shoppings">🏬 Shoppings</label>
                </div>
                <div class="checkbox-item">
                  <input type="checkbox" id="other-segment" name="segment" />
                  <label for="other-segment">📍 Outros</label>
                </div>
              </div>
              <input
                type="text"
                id="other-segment-text"
                placeholder="Especifique outros segmentos"
                style="margin-top: 10px; display: none"
              />
            </div>

            <div class="checklist-item">
              <label>Tipo de gestão:</label>
              <div class="checkbox-group">
                <div class="checkbox-item">
                  <input
                    type="radio"
                    id="active-management"
                    name="management-type"
                    value="ativa"
                  />
                  <label for="active-management">Ativa</label>
                </div>
                <div class="checkbox-item">
                  <input
                    type="radio"
                    id="passive-management"
                    name="management-type"
                    value="passiva"
                  />
                  <label for="passive-management">Passiva</label>
                </div>
              </div>
            </div>

            <div class="checklist-item">
              <label>Comparação com IFIX:</label>
              <div class="checkbox-group">
                <div class="checkbox-item">
                  <input
                    type="radio"
                    id="above-ifix"
                    name="ifix-comparison"
                    value="acima"
                  />
                  <label for="above-ifix">📈 Acima</label>
                </div>
                <div class="checkbox-item">
                  <input
                    type="radio"
                    id="below-ifix"
                    name="ifix-comparison"
                    value="abaixo"
                  />
                  <label for="below-ifix">📉 Abaixo</label>
                </div>
                <div class="checkbox-item">
                  <input
                    type="radio"
                    id="with-ifix"
                    name="ifix-comparison"
                    value="junto"
                  />
                  <label for="with-ifix">➡️ Junto</label>
                </div>
              </div>
            </div>

            <div class="checklist-item">
              <label for="property-count">Quantidade de imóveis</label>
              <input
                type="number"
                id="property-count"
                placeholder="Número de imóveis no portfólio"
              />
            </div>

            <div class="checklist-item">
              <label>Alocação do Fundo</label>
              <div style="display: flex; gap: 10px; margin-top: 8px">
                <input
                  type="text"
                  id="allocation-properties"
                  placeholder="% Imóveis"
                />
                <input type="text" id="allocation-fiis" placeholder="% FIIs" />
                <input type="text" id="allocation-cash" placeholder="% Caixa" />
              </div>
            </div>

            <div class="checklist-item">
              <label>% de contratos</label>
              <div style="display: flex; gap: 10px; margin-top: 8px">
                <input
                  type="text"
                  id="typical-contracts"
                  placeholder="% Típicos"
                />
                <input
                  type="text"
                  id="atypical-contracts"
                  placeholder="% Atípicos"
                />
              </div>
            </div>

            <div class="checklist-item">
              <label for="average-contract-term"
                >Tempo médio de vencimento dos contratos (meses)</label
              >
              <input
                type="number"
                id="average-contract-term"
                placeholder="Tempo médio em meses"
              />
            </div>

            <!-- NOVOS CAMPOS ADICIONADOS -->
            <div class="checklist-item">
              <label for="admin-fee">Taxa de administração (%)</label>
              <input
                type="text"
                id="admin-fee"
                placeholder="Taxa de administração em %"
              />
            </div>

            <div class="checklist-item">
              <label for="performance-fee">Taxa de performance (%)</label>
              <input
                type="text"
                id="performance-fee"
                placeholder="Taxa de performance em %"
              />
            </div>

            <div class="checklist-item">
              <label for="ffo-vs-dy">Valor do FFO vs DY</label>
              <input
                type="text"
                id="ffo-vs-dy"
                placeholder="Comparação entre FFO e DY"
              />
            </div>

            <div class="checklist-item">
              <label for="extraordinary-revenue"
                >Se o FFO está abaixo do DY, fundo tem gerado receita
                extraordinária? Tem bastante saldo acumulado?</label
              >
              <textarea
                id="extraordinary-revenue"
                placeholder="Descreva a situação da receita extraordinária e saldo acumulado..."
              ></textarea>
            </div>
            <!-- FIM DOS NOVOS CAMPOS -->

            <div class="checklist-item">
              <label for="expiring-contracts"
                >Há contratos próximos do vencimento? Qual % da receita?</label
              >
              <textarea
                id="expiring-contracts"
                placeholder="Descreva a situação dos contratos..."
              ></textarea>
            </div>

            <div class="checklist-item">
              <label for="active-tenants">Quantos inquilinos ativos</label>
              <input
                type="number"
                id="active-tenants"
                placeholder="Número de inquilinos ativos"
              />
            </div>

            <div class="checklist-item">
              <label for="tenant-segments"
                >Segmentos de mercado dos inquilinos</label
              >
              <textarea
                id="tenant-segments"
                placeholder="Liste os segmentos de mercado..."
              ></textarea>
            </div>

            <div class="checklist-item">
              <label for="largest-sector"
                >% da carteira alocada no maior setor</label
              >
              <input
                type="text"
                id="largest-sector"
                placeholder="Percentual do maior setor"
              />
            </div>

            <div class="checklist-item">
              <label for="tenant-concentration"
                >Concentração em algum inquilino? Qual e qual %?</label
              >
              <textarea
                id="tenant-concentration"
                placeholder="Descreva a concentração..."
              ></textarea>
            </div>

            <div class="checklist-item">
              <label for="tenant-financials"
                >Situação financeira do inquilino com maior concentração</label
              >
              <textarea
                id="tenant-financials"
                placeholder="Descreva a situação financeira..."
              ></textarea>
            </div>

            <div class="checklist-item">
              <label>Existe inquilino em período de carência?</label>
              <div class="checkbox-group">
                <div class="checkbox-item">
                  <input
                    type="radio"
                    id="grace-period-yes"
                    name="grace-period"
                    value="sim"
                  />
                  <label for="grace-period-yes">Sim</label>
                </div>
                <div class="checkbox-item">
                  <input
                    type="radio"
                    id="grace-period-no"
                    name="grace-period"
                    value="nao"
                  />
                  <label for="grace-period-no">Não</label>
                </div>
              </div>
            </div>

            <div class="checklist-item">
              <label>Observações:</label>
              <textarea
                class="observations"
                placeholder="Anotações sobre a estrutura do fundo..."
              ></textarea>
            </div>
          </div>

          <!-- NOVA SEÇÃO: ANÁLISE DE FUNDOS DE PAPEL -->
          <div class="section">
            <div class="section-title">
              <span>📄</span>
              <h2>Análise de Fundos de Papel</h2>
            </div>

            <div class="checklist-item">
              <label>Alocação do Fundo</label>
              <div style="display: flex; gap: 10px; margin-top: 8px">
                <input
                  type="text"
                  id="allocation-cri-cra"
                  placeholder="% CRI/CRA"
                />
                <input
                  type="text"
                  id="allocation-fiis-paper"
                  placeholder="% FIIs"
                />
                <input
                  type="text"
                  id="allocation-cash-paper"
                  placeholder="% Caixa"
                />
              </div>
            </div>

            <div class="checklist-item">
              <label for="credits-count">Quantidade de créditos</label>
              <input
                type="number"
                id="credits-count"
                placeholder="Número total de créditos"
              />
            </div>

            <div class="checklist-item">
              <label>Indexador do fundo</label>
              <div style="display: flex; gap: 10px; margin-top: 8px">
                <input type="text" id="indexer-cdi" placeholder="% CDI" />
                <input type="text" id="indexer-ipca" placeholder="% IPCA" />
              </div>
            </div>

            <div class="checklist-item">
              <label>Taxa média dos créditos</label>
              <div style="display: flex; gap: 10px; margin-top: 8px">
                <input type="text" id="credit-rate-cdi" placeholder="CDI+X%" />
                <input
                  type="text"
                  id="credit-rate-ipca"
                  placeholder="IPCA+X%"
                />
              </div>
            </div>

            <div class="checklist-item">
              <label for="credit-duration"
                >Duration da carteira de créditos (anos)</label
              >
              <input
                type="text"
                id="credit-duration"
                placeholder="Duration média em anos"
              />
            </div>

            <div class="checklist-item">
              <label>Garantias praticadas pelo fundo:</label>
              <div class="checkbox-group">
                <div class="checkbox-item">
                  <input
                    type="checkbox"
                    id="warranty-fiduciary-alienation"
                    name="warranty"
                  />
                  <label for="warranty-fiduciary-alienation"
                    >Alienação fiduciária</label
                  >
                </div>
                <div class="checkbox-item">
                  <input
                    type="checkbox"
                    id="warranty-fiduciary-cession"
                    name="warranty"
                  />
                  <label for="warranty-fiduciary-cession"
                    >Cessão fiduciária</label
                  >
                </div>
                <div class="checkbox-item">
                  <input
                    type="checkbox"
                    id="warranty-mortgage"
                    name="warranty"
                  />
                  <label for="warranty-mortgage">Hipoteca</label>
                </div>
                <div class="checkbox-item">
                  <input
                    type="checkbox"
                    id="warranty-reserves"
                    name="warranty"
                  />
                  <label for="warranty-reserves">Reservas</label>
                </div>
                <div class="checkbox-item">
                  <input
                    type="checkbox"
                    id="warranty-guarantors"
                    name="warranty"
                  />
                  <label for="warranty-guarantors">Fiadores</label>
                </div>
                <div class="checkbox-item">
                  <input
                    type="checkbox"
                    id="warranty-participation"
                    name="warranty"
                  />
                  <label for="warranty-participation">Participação</label>
                </div>
                <div class="checkbox-item">
                  <input type="checkbox" id="warranty-rating" name="warranty" />
                  <label for="warranty-rating">Rating</label>
                </div>
              </div>
            </div>

            <div class="checklist-item">
              <label>Fundo possui créditos sem garantias?</label>
              <div class="checkbox-group">
                <div class="checkbox-item">
                  <input
                    type="radio"
                    id="unsecured-credits-yes"
                    name="unsecured-credits"
                    value="sim"
                  />
                  <label for="unsecured-credits-yes">Sim</label>
                </div>
                <div class="checkbox-item">
                  <input
                    type="radio"
                    id="unsecured-credits-no"
                    name="unsecured-credits"
                    value="nao"
                  />
                  <label for="unsecured-credits-no">Não</label>
                </div>
              </div>
            </div>

            <div class="checklist-item">
              <label for="average-ltv"
                >LTV médio (razão entre o valor do crédito e o valor da
                garantia)</label
              >
              <input
                type="text"
                id="average-ltv"
                placeholder="LTV médio em %"
              />
            </div>

            <div class="checklist-item">
              <label for="debtor-segments"
                >Segmentos de mercado dos devedores</label
              >
              <textarea
                id="debtor-segments"
                placeholder="Liste os segmentos de mercado dos devedores..."
              ></textarea>
            </div>

            <div class="checklist-item">
              <label for="debtor-concentration"
                >Concentração da carteira em algum devedor? Qual devedor e
                %</label
              >
              <textarea
                id="debtor-concentration"
                placeholder="Descreva a concentração em devedores..."
              ></textarea>
            </div>

            <div class="checklist-item">
              <label for="main-debtor-financials"
                >Situação financeira do devedor com maior concentração</label
              >
              <textarea
                id="main-debtor-financials"
                placeholder="Descreva a situação financeira do principal devedor..."
              ></textarea>
            </div>

            <div class="checklist-item">
              <label>Observações:</label>
              <textarea
                class="observations"
                placeholder="Anotações sobre fundos de papel..."
              ></textarea>
            </div>
          </div>
          <!-- FIM DA NOVA SEÇÃO -->

          <!-- 🔎 GOVERNANÇA E GESTÃO -->
          <div class="section">
            <div class="section-title">
              <span>🔎</span>
              <h2>Governança e Gestão</h2>
            </div>

            <div class="checklist-item">
              <label for="manager-history"
                >Quem é o gestor e qual o histórico dela no mercado?</label
              >
              <textarea
                id="manager-history"
                placeholder="Descreva o gestor e seu histórico..."
              ></textarea>
            </div>

            <div class="checklist-item">
              <label>Existe troca de gestor ou equipe recente?</label>
              <div class="checkbox-group">
                <div class="checkbox-item">
                  <input
                    type="radio"
                    id="manager-change-yes"
                    name="manager-change"
                    value="sim"
                  />
                  <label for="manager-change-yes">Sim</label>
                </div>
                <div class="checkbox-item">
                  <input
                    type="radio"
                    id="manager-change-no"
                    name="manager-change"
                    value="nao"
                  />
                  <label for="manager-change-no">Não</label>
                </div>
              </div>
            </div>

            <div class="checklist-item">
              <label for="manager-change-details"
                >Se houve troca, detalhe as circunstâncias:</label
              >
              <textarea
                id="manager-change-details"
                placeholder="Detalhe a troca de gestão..."
              ></textarea>
            </div>

            <div class="checklist-item">
              <label
                >O fundo tem conflitos de interest (gestor/administrador ligados
                a ativos/inquilinos)?</label
              >
              <div class="checkbox-group">
                <div class="checkbox-item">
                  <input
                    type="radio"
                    id="conflicts-yes"
                    name="conflicts"
                    value="sim"
                  />
                  <label for="conflicts-yes">Sim</label>
                </div>
                <div class="checkbox-item">
                  <input
                    type="radio"
                    id="conflicts-no"
                    name="conflicts"
                    value="nao"
                  />
                  <label for="conflicts-no">Não</label>
                </div>
              </div>
            </div>

            <div class="checklist-item">
              <label for="conflicts-details"
                >Se houver conflitos, detalhe:</label
              >
              <textarea
                id="conflicts-details"
                placeholder="Descreva os conflitos de interesse..."
              ></textarea>
            </div>

            <div class="checklist-item">
              <label>Grau de transparência dos relatórios:</label>
              <div class="checkbox-group">
                <div class="checkbox-item">
                  <input
                    type="radio"
                    id="transparency-high"
                    name="transparency"
                    value="alta"
                  />
                  <label for="transparency-high"
                    >Alta (claros e detalhados)</label
                  >
                </div>
                <div class="checkbox-item">
                  <input
                    type="radio"
                    id="transparency-medium"
                    name="transparency"
                    value="media"
                  />
                  <label for="transparency-medium">Média</label>
                </div>
                <div class="checkbox-item">
                  <input
                    type="radio"
                    id="transparency-low"
                    name="transparency"
                    value="baixa"
                  />
                  <label for="transparency-low">Baixa (superficiais)</label>
                </div>
              </div>
            </div>

            <div class="checklist-item">
              <label>Observações:</label>
              <textarea
                class="observations"
                placeholder="Anotações sobre governança e gestão..."
              ></textarea>
            </div>
          </div>

          <!-- VACÂNCIA E RECEITA -->
          <div class="section">
            <div class="section-title">
              <span>📊</span>
              <h2>Vacância e Receita</h2>
            </div>

            <div class="checklist-item">
              <label for="financial-vacancy">Vacância financeira (%)</label>
              <input
                type="text"
                id="financial-vacancy"
                placeholder="Percentual de vacância financeira"
              />
            </div>

            <div class="checklist-item">
              <label for="physical-vacancy">Vacância física (%)</label>
              <input
                type="text"
                id="physical-vacancy"
                placeholder="Percentual de vacância física"
              />
            </div>

            <div class="checklist-item">
              <label for="default-rate">Inadimplência (%)</label>
              <input
                type="text"
                id="default-rate"
                placeholder="Percentual de inadimplência"
              />
            </div>

            <div class="checklist-item">
              <label>Resultado superior ou inferior ao mês anterior?</label>
              <div class="checkbox-group">
                <div class="checkbox-item">
                  <input
                    type="radio"
                    id="result-higher"
                    name="result-comparison"
                    value="superior"
                  />
                  <label for="result-higher">Superior</label>
                </div>
                <div class="checkbox-item">
                  <input
                    type="radio"
                    id="result-lower"
                    name="result-comparison"
                    value="inferior"
                  />
                  <label for="result-lower">Inferior</label>
                </div>
                <div class="checkbox-item">
                  <input
                    type="radio"
                    id="result-same"
                    name="result-comparison"
                    value="igual"
                  />
                  <label for="result-same">Igual</label>
                </div>
              </div>
            </div>

            <div class="checklist-item">
              <label for="result-reason">Se diferente, qual o motivo?</label>
              <textarea
                id="result-reason"
                placeholder="Explique o motivo da variação..."
              ></textarea>
            </div>

            <div class="checklist-item">
              <label>Observações:</label>
              <textarea
                class="observations"
                placeholder="Anotações sobre vacância and receita..."
              ></textarea>
            </div>
          </div>

          <!-- 📈 DESEMPENHO COMPARATIVO -->
          <div class="section">
            <div class="section-title">
              <span>📈</span>
              <h2>Desempenho Comparativo</h2>
            </div>

            <div class="checklist-item">
              <label for="vpc-evolution"
                >Evolução do valor patrimonial por cota (VPC) nos últimos 12
                meses</label
              >
              <textarea
                id="vpc-evolution"
                placeholder="Descreva a evolução do VPC..."
              ></textarea>
            </div>

            <div class="checklist-item">
              <label for="current-vs-avg"
                >Cotação atual vs média dos últimos 12 meses</label
              >
              <input
                type="text"
                id="current-vs-avg"
                placeholder="Ex: 5% acima, 10% abaixo"
              />
            </div>

            <div class="checklist-item">
              <label for="yield-comparison"
                >Rendimento atual vs média histórica (em %)</label
              >
              <input
                type="text"
                id="yield-comparison"
                placeholder="Ex: 6.5% vs 7.2%"
              />
            </div>

            <div class="checklist-item">
              <label for="sector-comparison"
                >DY vs média do setor (logística, lajes, shopping, etc.)</label
              >
              <input
                type="text"
                id="sector-comparison"
                placeholder="Ex: 0.5% acima da média de shoppings"
              />
            </div>

            <div class="checklist-item">
              <label>Classificação do fundo:</label>
              <div class="checkbox-group">
                <div class="checkbox-item">
                  <input
                    type="checkbox"
                    id="risk-fund"
                    name="fund-classification"
                  />
                  <label for="risk-fund">⚠️ Risco</label>
                </div>
                <div class="checkbox-item">
                  <input
                    type="checkbox"
                    id="growth-fund"
                    name="fund-classification"
                  />
                  <label for="growth-fund">📈 Crescimento</label>
                </div>
                <div class="checkbox-item">
                  <input
                    type="checkbox"
                    id="anchor-fund"
                    name="fund-classification"
                  />
                  <label for="anchor-fund">⚓ Ancoragem</label>
                </div>
              </div>
            </div>

            <div class="checklist-item">
              <label>Observações:</label>
              <textarea
                class="observations"
                placeholder="Anotações sobre desempenho comparativo..."
              ></textarea>
            </div>
          </div>

          <!-- ALAVANCAGEM E ESTRUTURA DE CAPITAL -->
          <div class="section">
            <div class="section-title">
              <span>💰</span>
              <h2>Alavancagem e Estrutura de Capital</h2>
            </div>

            <div class="checklist-item">
              <label>Existe alavancagem?</label>
              <div class="checkbox-group">
                <div class="checkbox-item">
                  <input
                    type="radio"
                    id="leverage-yes"
                    name="leverage"
                    value="sim"
                  />
                  <label for="leverage-yes">Sim</label>
                </div>
                <div class="checkbox-item">
                  <input
                    type="radio"
                    id="leverage-no"
                    name="leverage"
                    value="nao"
                  />
                  <label for="leverage-no">Não</label>
                </div>
              </div>
            </div>

            <div class="checklist-item">
              <label for="leverage-rate">Taxa média da alavancagem (%)</label>
              <input
                type="text"
                id="leverage-rate"
                placeholder="Taxa média de juros"
              />
            </div>

            <div class="checklist-item">
              <label for="amortization-plan"
                >Plano de amortização detalhado</label
              >
              <textarea
                id="amortization-plan"
                placeholder="Descreva o plano de amortização..."
              ></textarea>
            </div>

            <div class="checklist-item">
              <label>Observações:</label>
              <textarea
                class="observations"
                placeholder="Anotações sobre alavancagem..."
              ></textarea>
            </div>
          </div>

          <!-- LIQUIDEZ E MERCADO -->
          <div class="section">
            <div class="section-title">
              <span>📈</span>
              <h2>Liquidez e Mercado</h2>
            </div>

            <div class="checklist-item">
              <label>Liquidez: estabilizada, crescente ou decrescente?</label>
              <div class="checkbox-group">
                <div class="checkbox-item">
                  <input
                    type="radio"
                    id="liquidity-stable"
                    name="liquidity"
                    value="estavel"
                  />
                  <label for="liquidity-stable">Estabilizada</label>
                </div>
                <div class="checkbox-item">
                  <input
                    type="radio"
                    id="liquidity-increasing"
                    name="liquidity"
                    value="crescente"
                  />
                  <label for="liquidity-increasing">Crescente</label>
                </div>
                <div class="checkbox-item">
                  <input
                    type="radio"
                    id="liquidity-decreasing"
                    name="liquidity"
                    value="decrescente"
                  />
                  <label for="liquidity-decreasing">Decrescente</label>
                </div>
              </div>
            </div>

            <div class="checklist-item">
              <label for="important-notices"
                >Comunicados importantes no período (aquisições, vendas, novos
                contratos, problemas com inquilinos)</label
              >
              <textarea
                id="important-notices"
                placeholder="Liste os comunicados importantes..."
              ></textarea>
            </div>

            <div class="checklist-item">
              <label>Observações:</label>
              <textarea
                class="observations"
                placeholder="Anotações sobre liquidez e mercado..."
              ></textarea>
            </div>
          </div>

          <!-- AVALIAÇÃO DE RISCO E OPORTUNIDADE -->
          <div class="section">
            <div class="section-title">
              <span>⚖️</span>
              <h2>Avaliação de Risco e Oportunidade</h2>
            </div>

            <div class="checklist-item">
              <label>Risco: baixo / médio / alto?</label>
              <div class="checkbox-group">
                <div class="checkbox-item">
                  <input
                    type="radio"
                    id="risk-low"
                    name="risk-level"
                    value="baixo"
                  />
                  <label for="risk-low">Baixo</label>
                </div>
                <div class="checkbox-item">
                  <input
                    type="radio"
                    id="risk-medium"
                    name="risk-level"
                    value="medio"
                  />
                  <label for="risk-medium">Médio</label>
                </div>
                <div class="checkbox-item">
                  <input
                    type="radio"
                    id="risk-high"
                    name="risk-level"
                    value="alto"
                  />
                  <label for="risk-high">Alto</label>
                </div>
              </div>
            </div>

            <div class="checklist-item">
              <label for="main-risks"
                >Principais riscos elencados (ex.: concentração, vacância,
                endividamento, setor específico)</label
              >
              <textarea
                id="main-risks"
                placeholder="Liste os principais riscos..."
              ></textarea>
            </div>

            <div class="checklist-item">
              <label for="opportunities"
                >Existem oportunidades claras? (ex.: nova ancoragem, desconto de
                mercado, potencial de crescimento)</label
              >
              <textarea
                id="opportunities"
                placeholder="Descreva as oportunidades..."
              ></textarea>
            </div>

            <div class="checklist-item">
              <label>O fundo apresenta ancoragem sólida?</label>
              <div class="checkbox-group">
                <div class="checkbox-item">
                  <input
                    type="radio"
                    id="anchor-yes"
                    name="anchor"
                    value="sim"
                  />
                  <label for="anchor-yes">Sim</label>
                </div>
                <div class="checkbox-item">
                  <input
                    type="radio"
                    id="anchor-no"
                    name="anchor"
                    value="nao"
                  />
                  <label for="anchor-no">Não</label>
                </div>
                <div class="checkbox-item">
                  <input
                    type="radio"
                    id="anchor-partial"
                    name="anchor"
                    value="parcial"
                  />
                  <label for="anchor-partial">Parcialmente</label>
                </div>
              </div>
            </div>

            <div class="checklist-item">
              <label>Observações:</label>
              <textarea
                class="observations"
                placeholder="Anotações sobre risco e oportunidade..."
              ></textarea>
            </div>
          </div>

          <!-- CONCLUSÃO -->
          <div class="section">
            <div class="section-title">
              <span>✅</span>
              <h2>Conclusão da Análise</h2>
            </div>

            <div class="checklist-item">
              <label for="positive-points">Pontos positivos:</label>
              <textarea
                id="positive-points"
                placeholder="Liste os pontos positivos..."
              ></textarea>
            </div>

            <div class="checklist-item">
              <label for="negative-points">Pontos negativos:</label>
              <textarea
                id="negative-points"
                placeholder="Liste os pontos negativos..."
              ></textarea>
            </div>

            <div class="checklist-item">
              <label for="cash-burn"
                >Fundo está queimando caixa? Se sim, por quê?</label
              >
              <textarea
                id="cash-burn"
                placeholder="Descreva a situação de caixa..."
              ></textarea>
            </div>

            <div class="checklist-item">
              <label for="balance-sustainability"
                >O saldo acumulado sustentará a distribution por quanto
                tempo?</label
              >
              <input
                type="text"
                id="balance-sustainability"
                placeholder="Ex: 12 meses"
              />
            </div>

            <div class="checklist-item">
              <label for="discount"
                >O fundo está descontado? Se sim, esse desconto é
                justificável?</label
              >
              <textarea
                id="discount"
                placeholder="Analise o desconto..."
              ></textarea>
            </div>

            <div class="checklist-item">
              <label>Expectativa para próximos resultados:</label>
              <div class="checkbox-group">
                <div class="checkbox-item">
                  <input
                    type="radio"
                    id="expect-improve"
                    name="expectation"
                    value="melhora"
                  />
                  <label for="expect-improve">Melhora</label>
                </div>
                <div class="checkbox-item">
                  <input
                    type="radio"
                    id="expect-stable"
                    name="expectation"
                    value="estabilidade"
                  />
                  <label for="expect-stable">Estabilidade</label>
                </div>
                <div class="checkbox-item">
                  <input
                    type="radio"
                    id="expect-worse"
                    name="expectation"
                    value="piora"
                  />
                  <label for="expect-worse">Piora</label>
                </div>
              </div>
            </div>

            <div class="checklist-item">
              <label>Recomendação:</label>
              <div class="checkbox-group">
                <div class="checkbox-item">
                  <input
                    type="radio"
                    id="recommend-follow"
                    name="recommendation"
                    value="acompanhar"
                  />
                  <label for="recommend-follow">✔️ Acompanhar</label>
                </div>
                <div class="checkbox-item">
                  <input
                    type="radio"
                    id="recommend-increase"
                    name="recommendation"
                    value="aumentar"
                  />
                  <label for="recommend-increase">✔️ Aumentar posição</label>
                </div>
                <div class="checkbox-item">
                  <input
                    type="radio"
                    id="recommend-reduce"
                    name="recommendation"
                    value="reduzir"
                  />
                  <label for="recommend-reduce">✔️ Reduzir exposição</label>
                </div>
                <div class="checkbox-item">
                  <input
                    type="radio"
                    id="recommend-avoid"
                    name="recommendation"
                    value="evitar"
                  />
                  <label for="recommend-avoid">✔️ Evitar</label>
                </div>
              </div>
            </div>

            <div class="checklist-item">
              <label>Observações finais:</label>
              <textarea
                class="observations"
                placeholder="Considerações finais..."
              ></textarea>
            </div>
          </div>

          <div class="btn-group">
            <button type="button" class="btn-save" id="save-btn">
              <i class="fas fa-save"></i> Salvar Análise
            </button>
            <button type="reset" class="btn-reset">
              <i class="fas fa-trash"></i> Limpar Formulário
            </button>
            <button type="button" class="btn-print" id="print-btn">
              <i class="fas fa-print"></i> Imprimir/Exportar
            </button>
          </div>
        </form>
      </div>

      <div class="tab-content" id="reports-tab">
        <h2><i class="fas fa-file-alt"></i> Relatórios Salvos</h2>
        <p>Encontre e gerencie suas análises salvas</p>

        <div class="search-box">
          <input
            type="text"
            id="search-input"
            placeholder="Pesquisar por nome do fundo ou data..."
          />
          <button class="btn-save" id="search-btn">
            <i class="fas fa-search"></i> Pesquisar
          </button>
        </div>

        <div id="reports-message"></div>

        <div class="storage-info">
          <p>Relatórios salvos: <span id="reports-count">0</span></p>
          <button class="btn-reset" id="clear-all-btn">
            <i class="fas fa-trash"></i> Limpar Todos os Relatórios
          </button>
        </div>

        <div class="reports-list" id="reports-list">
          <!-- Os relatórios serão listados aqui via JavaScript -->
        </div>
      </div>

      <div class="tab-content" id="help-tab">
        <h2><i class="fas fa-question-circle"></i> Ajuda e Informações</h2>

        <div class="section">
          <h3>Onde os relatórios são salvos?</h3>
          <p>
            Todos os relatórios são salvos na nuvem usando
            <strong>Firebase</strong>.
          </p>
          <p>
            Isso significa que você pode acessar suas análises de qualquer
            dispositivo após fazer login.
          </p>
        </div>

        <div class="section">
          <h3>Como pesquisar relatórios?</h3>
          <p>
            Na aba "Relatórios Salvos", digite o nome do fundo ou a data no
            campo de pesquisa и clique no botão "Pesquisar".
          </p>
          <p>
            Você também pode visualizar, carregar ou excluir relatórios
            individualmente usando os botões ao lado de cada relatório.
          </p>
        </div>

        <div class="section">
          <h3>Como imprimir ou exportar?</h3>
          <p>
            Use o botão "Imprimir/Exportar" para gerar uma versão para impressão
            da análise atual.
          </p>
          <p>
            Na visualização de impressão, você can save as PDF usando a função
            "Salvar como PDF" do seu navegador.
          </p>
        </div>

        <div class="section">
          <h3>Os dados serão perdidos se eu limpar o navegador?</h3>
          <p>
            Não, pois os dados são salvos na nuvem. Se você limpar o histórico e
            dados de navegação, basta fazer login novamente para recuperar suas
            análises.
          </p>
        </div>
      </div>
    </div>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        // Configuração do Firebase
        const firebaseConfig = {
          apiKey: "AIzaSyDCplzRR5imGdGCpr6PnKEwo2rs5qPrV6c",
          authDomain: "rianalise.firebaseapp.com",
          projectId: "rianalise",
          storageBucket: "rianalise.firebasestorage.app",
          messagingSenderId: "46433102386",
          appId: "1:46433102386:web:918bfbc2f0834604daaa2b",
          measurementId: "G-ZQ2178VY8N",
        };

        // Inicializar Firebase
        let db = null;
        let auth = null;
        let isFirebaseInitialized = false;

        try {
          // Verificar se o Firebase já foi inicializado
          if (!firebase.apps.length) {
            firebase.initializeApp(firebaseConfig);
          }

          db = firebase.firestore();
          auth = firebase.auth();
          isFirebaseInitialized = true;

          // Atualizar status
          document.getElementById("firebase-status").textContent =
            "Banco de dados conectado";
          document.getElementById("firebase-status").className =
            "firebase-status status-connected";

          console.log("Firebase inicializado com sucesso");
        } catch (error) {
          console.error("Erro ao inicializar Firebase:", error);
          document.getElementById("firebase-status").textContent =
            "Erro ao inicializar Firebase: " + error.message;
          document.getElementById("firebase-status").className =
            "firebase-status status-disconnected";
        }

        // Elementos da interface
        const tabs = document.querySelectorAll(".tab");
        const tabContents = document.querySelectorAll(".tab-content");
        const otherSegmentCheckbox = document.getElementById("other-segment");
        const otherSegmentText = document.getElementById("other-segment-text");
        const saveBtn = document.getElementById("save-btn");
        const printBtn = document.getElementById("print-btn");
        const searchBtn = document.getElementById("search-btn");
        const searchInput = document.getElementById("search-input");
        const clearAllBtn = document.getElementById("clear-all-btn");
        const reportsList = document.getElementById("reports-list");
        const reportsCount = document.getElementById("reports-count");
        const loginBtn = document.getElementById("login-btn");
        const logoutBtn = document.getElementById("logout-btn");
        const userInfo = document.getElementById("user-info");
        const userEmail = document.getElementById("user-email");
        const firebaseStatus = document.getElementById("firebase-status");
        const reportsMessage = document.getElementById("reports-message");

        // Estado da aplicação
        let currentUser = null;

        // Monitorar estado de autenticação se o Firebase foi inicializado
        if (isFirebaseInitialized) {
          auth.onAuthStateChanged((user) => {
            if (user) {
              currentUser = user;
              userEmail.textContent = user.email;
              userInfo.style.display = "block";
              loginBtn.style.display = "none";
              logoutBtn.style.display = "block";
              console.log("Usuário logado:", user.email);

              // Atualizar lista de relatórios se estiver na aba correta
              if (
                document
                  .querySelector(".tab.active")
                  .getAttribute("data-tab") === "reports"
              ) {
                updateReportsList();
              }
            } else {
              currentUser = null;
              userInfo.style.display = "none";
              loginBtn.style.display = "block";
              logoutBtn.style.display = "none";
              console.log("Usuário não logado");

              // Limpar lista de relatórios se não estiver logado
              if (
                document
                  .querySelector(".tab.active")
                  .getAttribute("data-tab") === "reports"
              ) {
                reportsList.innerHTML =
                  "<p>Faça login para ver seus relatórios salvos.</p>";
              }
            }
          });
        } else {
          firebaseStatus.textContent =
            "Firebase não inicializado. Verifique a configuração.";
          firebaseStatus.className = "firebase-status status-disconnected";
        }

        // Login com Google
        loginBtn.addEventListener("click", () => {
          if (!isFirebaseInitialized) {
            alert(
              "Firebase não inicializado. Verifique sua conexão com a internet."
            );
            return;
          }

          const provider = new firebase.auth.GoogleAuthProvider();
          auth
            .signInWithPopup(provider)
            .then((result) => {
              console.log("Login bem-sucedido:", result.user);
            })
            .catch((error) => {
              console.error("Erro no login:", error);
              if (error.code === "auth/unauthorized-domain") {
                alert(
                  "Erro: Domínio não autorizado. Você precisa configurar seu domínio no Console do Firebase. Veja as instruções na seção de configuração."
                );
              } else {
                alert("Erro ao fazer login: " + error.message);
              }
            });
        });

        // Logout
        logoutBtn.addEventListener("click", () => {
          if (isFirebaseInitialized) {
            auth
              .signOut()
              .then(() => {
                console.log("Logout bem-sucedido");
              })
              .catch((error) => {
                console.error("Erro no logout:", error);
              });
          }
        });

        // Sistema de abas
        tabs.forEach((tab) => {
          tab.addEventListener("click", () => {
            const tabId = tab.getAttribute("data-tab");

            // Ativar aba clicada
            tabs.forEach((t) => t.classList.remove("active"));
            tab.classList.add("active");

            // Mostrar conteúdo correspondente
            tabContents.forEach((content) => {
              content.classList.remove("active");
              if (content.id === `${tabId}-tab`) {
                content.classList.add("active");
              }
            });

            // Se for a aba de relatórios, atualizar a lista
            if (tabId === "reports") {
              updateReportsList();
            }
          });
        });

        // Mostrar campo de texto para "Outros" segmentos quando selecionado
        otherSegmentCheckbox.addEventListener("change", function () {
          otherSegmentText.style.display = this.checked ? "block" : "none";
        });

        // Preencher automaticamente a data atual no campo de data
        const today = new Date();
        const month = today.getMonth() + 1;
        const year = today.getFullYear();
        document.getElementById("analysis-date").value = `${month
          .toString()
          .padStart(2, "0")}/${year}`;

        // Salvar dados no Firebase
        saveBtn.addEventListener("click", function () {
          if (!isFirebaseInitialized) {
            alert(
              "Firebase não está inicializado. Verifique sua conexão e tente novamente."
            );
            return;
          }

          if (!currentUser) {
            alert("Faça login para salvar suas análises na nuvem.");
            return;
          }

          const fundName = document.getElementById("fund-name").value;
          if (!fundName) {
            alert("Por favor, informe o nome do fundo antes de salvar.");
            return;
          }

          // Coletar todos os dados do formulário (incluindo os novos campos)
          const formData = {
            fundName: fundName,
            analysisDate: document.getElementById("analysis-date").value,
            analystName: document.getElementById("analyst-name").value,
            strategy: document.getElementById("strategy").value,
            segments: getSelectedCheckboxes("segment"),
            otherSegment: document.getElementById("other-segment-text").value,
            managementType: getSelectedRadio("management-type"),
            ifixComparison: getSelectedRadio("ifix-comparison"),
            propertyCount: document.getElementById("property-count").value,
            allocationProperties: document.getElementById(
              "allocation-properties"
            ).value,
            allocationFiis: document.getElementById("allocation-fiis").value,
            allocationCash: document.getElementById("allocation-cash").value,
            typicalContracts:
              document.getElementById("typical-contracts").value,
            atypicalContracts:
              document.getElementById("atypical-contracts").value,
            averageContractTerm: document.getElementById(
              "average-contract-term"
            ).value,
            // Novos campos adicionados
            adminFee: document.getElementById("admin-fee").value,
            performanceFee: document.getElementById("performance-fee").value,
            ffoVsDy: document.getElementById("ffo-vs-dy").value,
            extraordinaryRevenue: document.getElementById(
              "extraordinary-revenue"
            ).value,
            // Campos da nova seção de fundos de papel
            allocationCriCra:
              document.getElementById("allocation-cri-cra").value,
            allocationFiisPaper: document.getElementById(
              "allocation-fiis-paper"
            ).value,
            allocationCashPaper: document.getElementById(
              "allocation-cash-paper"
            ).value,
            creditsCount: document.getElementById("credits-count").value,
            indexerCdi: document.getElementById("indexer-cdi").value,
            indexerIpca: document.getElementById("indexer-ipca").value,
            creditRateCdi: document.getElementById("credit-rate-cdi").value,
            creditRateIpca: document.getElementById("credit-rate-ipca").value,
            creditDuration: document.getElementById("credit-duration").value,
            warranties: getSelectedCheckboxes("warranty"),
            unsecuredCredits: getSelectedRadio("unsecured-credits"),
            averageLtv: document.getElementById("average-ltv").value,
            debtorSegments: document.getElementById("debtor-segments").value,
            debtorConcentration: document.getElementById("debtor-concentration")
              .value,
            mainDebtorFinancials: document.getElementById(
              "main-debtor-financials"
            ).value,
            // Fim dos novos campos
            expiringContracts:
              document.getElementById("expiring-contracts").value,
            activeTenants: document.getElementById("active-tenants").value,
            tenantSegments: document.getElementById("tenant-segments").value,
            largestSector: document.getElementById("largest-sector").value,
            tenantConcentration: document.getElementById("tenant-concentration")
              .value,
            tenantFinancials:
              document.getElementById("tenant-financials").value,
            gracePeriod: getSelectedRadio("grace-period"),
            managerHistory: document.getElementById("manager-history").value,
            managerChange: getSelectedRadio("manager-change"),
            managerChangeDetails: document.getElementById(
              "manager-change-details"
            ).value,
            conflicts: getSelectedRadio("conflicts"),
            conflictsDetails:
              document.getElementById("conflicts-details").value,
            transparency: getSelectedRadio("transparency"),
            vpcEvolution: document.getElementById("vpc-evolution").value,
            currentVsAvg: document.getElementById("current-vs-avg").value,
            yieldComparison: document.getElementById("yield-comparison").value,
            sectorComparison:
              document.getElementById("sector-comparison").value,
            fundClassification: getSelectedCheckboxes("fund-classification"),
            financialVacancy:
              document.getElementById("financial-vacancy").value,
            physicalVacancy: document.getElementById("physical-vacancy").value,
            defaultRate: document.getElementById("default-rate").value,
            resultComparison: getSelectedRadio("result-comparison"),
            resultReason: document.getElementById("result-reason").value,
            leverage: getSelectedRadio("leverage"),
            leverageRate: document.getElementById("leverage-rate").value,
            amortizationPlan:
              document.getElementById("amortization-plan").value,
            liquidity: getSelectedRadio("liquidity"),
            importantNotices:
              document.getElementById("important-notices").value,
            riskLevel: getSelectedRadio("risk-level"),
            mainRisks: document.getElementById("main-risks").value,
            opportunities: document.getElementById("opportunities").value,
            anchor: getSelectedRadio("anchor"),
            positivePoints: document.getElementById("positive-points").value,
            negativePoints: document.getElementById("negative-points").value,
            cashBurn: document.getElementById("cash-burn").value,
            balanceSustainability: document.getElementById(
              "balance-sustainability"
            ).value,
            discount: document.getElementById("discount").value,
            expectation: getSelectedRadio("expectation"),
            recommendation: getSelectedRadio("recommendation"),
            timestamp: new Date().toISOString(),
          };

          // Salvar no Firebase
          const firebaseData = {
            ...formData,
            userId: currentUser.uid,
            userEmail: currentUser.email,
            lastUpdated: firebase.firestore.FieldValue.serverTimestamp(),
          };

          // Mostrar indicador de carregamento
          const originalText = saveBtn.innerHTML;
          saveBtn.innerHTML = '<span class="loading"></span> Salvando...';
          saveBtn.disabled = true;

          db.collection("analises")
            .add(firebaseData)
            .then((docRef) => {
              console.log("Análise salva no Firebase com ID: ", docRef.id);
              saveBtn.innerHTML = originalText;
              saveBtn.disabled = false;
              alert(`Análise de ${fundName} salva com sucesso na nuvem!`);
            })
            .catch((error) => {
              console.error("Erro ao salvar no Firebase: ", error);
              saveBtn.innerHTML = originalText;
              saveBtn.disabled = false;
              alert(`Erro ao salvar na nuvem: ${error.message}`);
            });
        });

        // Imprimir/exportar formulário
        printBtn.addEventListener("click", function () {
          window.print();
        });

        // Pesquisar relatórios
        searchBtn.addEventListener("click", function () {
          updateReportsList(searchInput.value);
        });

        // Limpar todos os relatórios
        clearAllBtn.addEventListener("click", function () {
          if (
            confirm(
              "Tem certeza que deseja excluir TODOS os relatórios salvos? Esta ação não pode ser desfeita."
            )
          ) {
            // Esta função precisaria ser implementada para deletar todos os documentos do usuário
            alert(
              "Funcionalidade de limpar todos os relatórios ainda não implementada."
            );
          }
        });

        // Função para atualizar a lista de relatórios do Firebase
        async function updateReportsList(searchTerm = "") {
          reportsList.innerHTML =
            '<p><span class="loading"></span> Carregando relatórios...</p>';
          reportsMessage.innerHTML = "";

          // Se não estiver logado, não buscar relatórios
          if (!currentUser) {
            reportsList.innerHTML =
              "<p>Faça login para ver seus relatórios salvos na nuvem.</p>";
            return;
          }

          if (!isFirebaseInitialized) {
            reportsList.innerHTML =
              "<p>Firebase não inicializado. Não é possível carregar relatórios.</p>";
            return;
          }

          let reports = [];

          try {
            let query = db
              .collection("analises")
              .where("userId", "==", currentUser.uid)
              .orderBy("lastUpdated", "desc");

            const querySnapshot = await query.get();

            if (querySnapshot.empty) {
              reportsList.innerHTML =
                "<p>Nenhum relatório encontrado na nuvem.</p>";
              reportsMessage.innerHTML =
                '<div class="success-message">Nenhum relatório salvo ainda. Crie uma análise na aba "Nova Análise" para começar.</div>';
              return;
            }

            querySnapshot.forEach((doc) => {
              const data = doc.data();
              reports.push({ ...data, id: doc.id });
            });

            // Filtrar por termo de pesquisa se fornecido
            if (searchTerm) {
              reports = reports.filter(
                (report) =>
                  report.fundName
                    .toLowerCase()
                    .includes(searchTerm.toLowerCase()) ||
                  report.analysisDate
                    .toLowerCase()
                    .includes(searchTerm.toLowerCase())
              );
            }

            // Exibir os relatórios
            reportsList.innerHTML = "";

            if (reports.length === 0) {
              reportsList.innerHTML =
                "<p>Nenhum relatório encontrado com os critérios de pesquisa.</p>";
              return;
            }

            reportsCount.textContent = reports.length;

            reports.forEach((report) => {
              const reportElement = document.createElement("div");
              reportElement.className = "report-item";
              reportElement.innerHTML = `
                            <div class="report-info">
                                <h3>${report.fundName}</h3>
                                <p>Data: ${report.analysisDate} | Analista: ${
                report.analystName || "Não informado"
              }</p>
                                <p>Salvo em: ${new Date(
                                  report.timestamp
                                ).toLocaleString()}</p>
                            </div>
                            <div class="report-actions">
                                <button class="btn-save report-btn view-btn" data-id="${
                                  report.id
                                }">
                                    <i class="fas fa-eye"></i> Ver
                                </button>
                                <button class="btn-print report-btn load-btn" data-id="${
                                  report.id
                                }">
                                    <i class="fas fa-upload"></i> Carregar
                                </button>
                                <button class="btn-reset report-btn delete-btn" data-id="${
                                  report.id
                                }">
                                    <i class="fas fa-trash"></i> Excluir
                                </button>
                            </div>
                        `;

              reportsList.appendChild(reportElement);
            });

            // Adicionar event listeners aos botões
            document.querySelectorAll(".view-btn").forEach((btn) => {
              btn.addEventListener("click", function () {
                const id = this.getAttribute("data-id");
                viewReport(id);
              });
            });

            document.querySelectorAll(".load-btn").forEach((btn) => {
              btn.addEventListener("click", function () {
                const id = this.getAttribute("data-id");
                loadReport(id);
              });
            });

            document.querySelectorAll(".delete-btn").forEach((btn) => {
              btn.addEventListener("click", function () {
                const id = this.getAttribute("data-id");
                deleteReport(id);
              });
            });
          } catch (error) {
            console.error("Erro ao buscar relatórios do Firebase:", error);
            reportsList.innerHTML =
              "<p>Erro ao carregar relatórios do Firebase.</p>";
            reportsMessage.innerHTML = `<div class="error-message">Erro ao carregar relatórios: ${error.message}. Verifique sua conexão com a internet and tente novamente.</div>`;
          }
        }

        // Função para visualizar relatório
        async function viewReport(id) {
          try {
            const doc = await db.collection("analises").doc(id).get();
            if (doc.exists) {
              const report = doc.data();
              let content = `
                            <h2>Relatório: ${report.fundName}</h2>
                            <p><strong>Data:</strong> ${report.analysisDate}</p>
                            <p><strong>Analista:</strong> ${
                              report.analystName || "Não informado"
                            }</p>
                            <p><strong>Salvo em:</strong> ${new Date(
                              report.timestamp
                            ).toLocaleString()}</p>
                            <hr>
                            <h3>Estratégia/Objetivo:</h3>
                            <p>${report.strategy || "Não informado"}</p>
                            <h3>Pontos Positivos:</h3>
                            <p>${report.positivePoints || "Não informado"}</p>
                            <h3>Pontos Negativos:</h3>
                            <p>${report.negativePoints || "Não informado"}</p>
                        `;

              alert(content);
            } else {
              alert("Relatório não encontrado.");
            }
          } catch (error) {
            console.error("Erro ao buscar relatório:", error);
            alert("Erro ao buscar relatório: " + error.message);
          }
        }

        // Função para carregar relatório no formulário
        async function loadReport(id) {
          try {
            const doc = await db.collection("analises").doc(id).get();
            if (doc.exists) {
              const report = doc.data();

              // Preencher campos do formulário (incluindo os novos campos)
              document.getElementById("fund-name").value =
                report.fundName || "";
              document.getElementById("analysis-date").value =
                report.analysisDate || "";
              document.getElementById("analyst-name").value =
                report.analystName || "";
              document.getElementById("strategy").value = report.strategy || "";
              document.getElementById("property-count").value =
                report.propertyCount || "";
              document.getElementById("allocation-properties").value =
                report.allocationProperties || "";
              document.getElementById("allocation-fiis").value =
                report.allocationFiis || "";
              document.getElementById("allocation-cash").value =
                report.allocationCash || "";
              document.getElementById("typical-contracts").value =
                report.typicalContracts || "";
              document.getElementById("atypical-contracts").value =
                report.atypicalContracts || "";
              document.getElementById("average-contract-term").value =
                report.averageContractTerm || "";
              // Novos campos adicionados
              document.getElementById("admin-fee").value =
                report.adminFee || "";
              document.getElementById("performance-fee").value =
                report.performanceFee || "";
              document.getElementById("ffo-vs-dy").value = report.ffoVsDy || "";
              document.getElementById("extraordinary-revenue").value =
                report.extraordinaryRevenue || "";
              // Campos da nova seção de fundos de papel
              document.getElementById("allocation-cri-cra").value =
                report.allocationCriCra || "";
              document.getElementById("allocation-fiis-paper").value =
                report.allocationFiisPaper || "";
              document.getElementById("allocation-cash-paper").value =
                report.allocationCashPaper || "";
              document.getElementById("credits-count").value =
                report.creditsCount || "";
              document.getElementById("indexer-cdi").value =
                report.indexerCdi || "";
              document.getElementById("indexer-ipca").value =
                report.indexerIpca || "";
              document.getElementById("credit-rate-cdi").value =
                report.creditRateCdi || "";
              document.getElementById("credit-rate-ipca").value =
                report.creditRateIpca || "";
              document.getElementById("credit-duration").value =
                report.creditDuration || "";
              document.getElementById("average-ltv").value =
                report.averageLtv || "";
              document.getElementById("debtor-segments").value =
                report.debtorSegments || "";
              document.getElementById("debtor-concentration").value =
                report.debtorConcentration || "";
              document.getElementById("main-debtor-financials").value =
                report.mainDebtorFinancials || "";
              // Fim dos novos campos
              document.getElementById("expiring-contracts").value =
                report.expiringContracts || "";
              document.getElementById("active-tenants").value =
                report.activeTenants || "";
              document.getElementById("tenant-segments").value =
                report.tenantSegments || "";
              document.getElementById("largest-sector").value =
                report.largestSector || "";
              document.getElementById("tenant-concentration").value =
                report.tenantConcentration || "";
              document.getElementById("tenant-financials").value =
                report.tenantFinancials || "";
              document.getElementById("manager-history").value =
                report.managerHistory || "";
              document.getElementById("manager-change-details").value =
                report.managerChangeDetails || "";
              document.getElementById("conflicts-details").value =
                report.conflictsDetails || "";
              document.getElementById("vpc-evolution").value =
                report.vpcEvolution || "";
              document.getElementById("current-vs-avg").value =
                report.currentVsAvg || "";
              document.getElementById("yield-comparison").value =
                report.yieldComparison || "";
              document.getElementById("sector-comparison").value =
                report.sectorComparison || "";
              document.getElementById("financial-vacancy").value =
                report.financialVacancy || "";
              document.getElementById("physical-vacancy").value =
                report.physicalVacancy || "";
              document.getElementById("default-rate").value =
                report.defaultRate || "";
              document.getElementById("result-reason").value =
                report.resultReason || "";
              document.getElementById("leverage-rate").value =
                report.leverageRate || "";
              document.getElementById("amortization-plan").value =
                report.amortizationPlan || "";
              document.getElementById("important-notices").value =
                report.importantNotices || "";
              document.getElementById("main-risks").value =
                report.mainRisks || "";
              document.getElementById("opportunities").value =
                report.opportunities || "";
              document.getElementById("positive-points").value =
                report.positivePoints || "";
              document.getElementById("negative-points").value =
                report.negativePoints || "";
              document.getElementById("cash-burn").value =
                report.cashBurn || "";
              document.getElementById("balance-sustainability").value =
                report.balanceSustainability || "";
              document.getElementById("discount").value = report.discount || "";

              // Preencher checkboxes e radios
              if (report.otherSegment) {
                document.getElementById("other-segment").checked = true;
                document.getElementById("other-segment-text").value =
                  report.otherSegment;
                document.getElementById("other-segment-text").style.display =
                  "block";
              }

              // Selecionar opções de rádio
              selectRadioOption("management-type", report.managementType);
              selectRadioOption("ifix-comparison", report.ifixComparison);
              selectRadioOption("grace-period", report.gracePeriod);
              selectRadioOption("manager-change", report.managerChange);
              selectRadioOption("conflicts", report.conflicts);
              selectRadioOption("transparency", report.transparency);
              selectRadioOption("result-comparison", report.resultComparison);
              selectRadioOption("leverage", report.leverage);
              selectRadioOption("liquidity", report.liquidity);
              selectRadioOption("risk-level", report.riskLevel);
              selectRadioOption("anchor", report.anchor);
              selectRadioOption("expectation", report.expectation);
              selectRadioOption("recommendation", report.recommendation);
              selectRadioOption("unsecured-credits", report.unsecuredCredits);

              // Selecionar classificações do fundo
              if (report.fundClassification) {
                document
                  .querySelectorAll('input[name="fund-classification"]')
                  .forEach((cb) => {
                    cb.checked = report.fundClassification.includes(
                      cb.nextElementSibling.textContent
                    );
                  });
              }

              // Selecionar garantias
              if (report.warranties) {
                document
                  .querySelectorAll('input[name="warranty"]')
                  .forEach((cb) => {
                    cb.checked = report.warranties.includes(
                      cb.nextElementSibling.textContent
                    );
                  });
              }

              // Mudar para a aba do formulário
              tabs.forEach((t) => t.classList.remove("active"));
              tabContents.forEach((c) => c.classList.remove("active"));
              document
                .querySelector('.tab[data-tab="form"]')
                .classList.add("active");
              document.getElementById("form-tab").classList.add("active");

              alert(`Relatório de ${report.fundName} carregado com sucesso!`);
            } else {
              alert("Relatório não encontrado.");
            }
          } catch (error) {
            console.error("Erro ao carregar relatório:", error);
            alert("Erro ao carregar relatório: " + error.message);
          }
        }

        // Função auxiliar para selecionar opção de rádio
        function selectRadioOption(name, value) {
          if (!value) return;
          const radio = document.querySelector(
            `input[name="${name}"][value="${value}"]`
          );
          if (radio) radio.checked = true;
        }

        // Função para excluir relatório
        async function deleteReport(id) {
          try {
            const doc = await db.collection("analises").doc(id).get();
            if (doc.exists) {
              const reportName = doc.data().fundName;

              if (
                confirm(
                  `Tem certeza que deseja excluir o relatório de ${reportName}?`
                )
              ) {
                await db.collection("analises").doc(id).delete();
                alert("Relatório excluído com sucesso.");
                updateReportsList();
              }
            } else {
              alert("Relatório não encontrado.");
            }
          } catch (error) {
            console.error("Erro ao excluir relatório:", error);
            alert("Erro ao excluir relatório: " + error.message);
          }
        }

        // Funções auxiliares para obter valores de checkboxes e radios
        function getSelectedCheckboxes(name) {
          const checkboxes = document.querySelectorAll(
            `input[name="${name}"]:checked`
          );
          return Array.from(checkboxes).map(
            (cb) => cb.nextElementSibling.textContent
          );
        }

        function getSelectedRadio(name) {
          const radio = document.querySelector(`input[name="${name}"]:checked`);
          return radio ? radio.value : null;
        }
      });
    </script>
  </body>
</html>
